@model List<Presentation.Areas.Admin.ViewModels.UserListViewModel>
@{
    ViewData["Title"] = "User Management";
    var total = ViewBag.Total as int? ?? 0;
    var page = ViewBag.Page as int? ?? 1;
    var pageSize = ViewBag.PageSize as int? ?? 20;
    var search = ViewBag.Search as string ?? "";
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">@TempData["Success"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show">@TempData["Error"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0"><i class="bi bi-people me-2"></i>User Management</h2>
</div>
<form method="get" class="mb-4">
    <div class="input-group" style="max-width:400px">
        <input type="text" name="search" value="@search" class="form-control" placeholder="Search by email, username, name..." />
        <button type="submit" class="btn btn-primary"><i class="bi bi-search"></i></button>
    </div>
</form>
<div class="card glass-card border-0 shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Email</th>
                        <th>Full Name</th>
                        <th>Roles</th>
                        <th>Verified</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var u in Model)
                    {
                        <tr>
                            <td>@u.Email</td>
                            <td>@u.FullName</td>
                            <td><span class="badge bg-primary">@u.Roles</span></td>
                            <td>@(u.EmailConfirmed ? "✓" : "—")</td>
                            <td>@u.CreatedAt.ToString("yyyy-MM-dd")</td>
                            <td>
                                <a asp-action="EditRoles" asp-route-id="@u.Id" class="btn btn-sm btn-outline-primary">Edit Roles</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        @if (!Model.Any())
        {
            <div class="text-center text-muted py-5">No users found.</div>
        }
        @if (total > pageSize)
        {
            <div class="p-3 border-top d-flex justify-content-between align-items-center">
                <span class="text-muted">Showing @((page-1)*pageSize + 1)-@Math.Min(page*pageSize, total) of @total</span>
                <nav>
                    @if (page > 1)
                    {
                        <a href="?page=@(page-1)&pageSize=@pageSize&search=@Uri.EscapeDataString(search)" class="btn btn-sm btn-outline-secondary">Previous</a>
                    }
                    @if (page * pageSize < total)
                    {
                        <a href="?page=@(page+1)&pageSize=@pageSize&search=@Uri.EscapeDataString(search)" class="btn btn-sm btn-outline-secondary">Next</a>
                    }
                </nav>
            </div>
        }
    </div>
</div>
